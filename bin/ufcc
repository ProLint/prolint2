#!/usr/bin/env python3
r"""Argument parser to use ufcc from the command-line
======================================================
:Authors: Daniel P. Ramirez & Besian I. Sejdiu
:Year: 2022
:Copyright: MIT License
"""

import argparse
import ufcc._version as vers
from ufcc.server.server import start_server
import configparser
from ufcc import get_config

# Getting the config file
config = configparser.ConfigParser(allow_no_value=True)
config.read(get_config())
parameters_config = config["Parameters"]

# Creating the parser
ufcc_parser = argparse.ArgumentParser(
    prog="ufcc",
    usage='%(prog)s [optional-arguments] structure_file trajectory_file',
    description="Argument parser to use the ufcc library directly from the command-line.",
    formatter_class=argparse.ArgumentDefaultsHelpFormatter,
    epilog="Have fun getting lipid-protein contacts! :)\n",
)

ufcc_parser.version = vers.get_versions()["version"]

# positional arguments
ufcc_parser.add_argument(
    "structure", action="store", type=str, help="path to the structure/topology file."
)
ufcc_parser.add_argument(
    "trajectory", action="store", type=str, help="path to the trajectory file."
)

# optional arguments
ufcc_parser.add_argument("-v", "--version", action="version")
ufcc_parser.add_argument(
    "-c",
    "--cutoff",
    metavar="",
    type=int,
    help="distance cutoff to get the contacts (in angstroms).",
    default=int(parameters_config["cutoff"]),
    dest="cutoff",
)
ufcc_parser.add_argument(
    "-al",
    "--add_lipid_types",
    nargs="+",
    metavar="",
    help="additional lipid types to be included in the membrane group, supported lipid types are POPC, DPPC, DOPC, CHOL, CHL1, POPS and POPE.",
    dest="other_lipids",
    default=[],
)
ufcc_parser.add_argument(
    "-i",
    "--interactive",
    metavar="",
    action="store_const",
    help="interactive selection of the groups for the calculation of the contacts.",
    default=False,
    const=True,
    dest="i_bool",
)

# Executing the parse_args() method
args = ufcc_parser.parse_args()

# print("args", type(args), args)
start_server(payload=args, reloader=False, i_bool=args.i_bool)
import sys

sys.exit()


